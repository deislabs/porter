---
title: "Pack Your Bags: Managing Distributed Applications with CNAB"
description: |
  Learn how to use Cloud Native Application Bundles (CNAB) and Porter to bundle up your
  application and its infrastructure so that it is easier to manage.
url: "/pack-your-bags/"
---
class: center, middle

# Pack your bags
##  Managing Distributed Applications with CNAB

---
name: setup

# Workshop Setup

It can take a while for things to download and install over the workshop wifi,
so please go to the workshop materials directory and follow the setup instructions
to get all the materials ready.

.center[👩🏽‍✈️ https://porter.sh/pack-your-bags/#setup 👩🏽‍✈️ ]

* Clone the workshop repository
  ```
  git clone https://github.com/deislabs/porter.git
  cd porter/workshop
  ```
* [Install Porter](https://porter.sh/install)
* Create a Kubernetes Cluster on [macOS](https://docs.docker.com/docker-for-mac/kubernetes/) or [Windows](https://docs.docker.com/docker-for-windows/kubernetes/)
* [Install Helm 2](https://helm.sh/docs/install/)
* Initialize Helm on your cluster by running `helm init`


---
name: agenda

# Agenda

1. What is CNAB?
2. Manage Bundles with Porter
3. Authoring Bundles

---
name: introductions

# Introductions

😅<br/>
Carolyn Van Slyck<br/>
Senior Software Engineer<br/>
Microsoft Azure<br/>

😎<br/>
Jeremy Rickard<br/>
Senior Software Engineer<br/>
Microsoft Azure<br/>

---
name: cnab

# What is CNAB?

???
Explain why a spec is necessary

---
name: anatomy

# Anatomy of a Bundle

---
name: sharing

# Sharing Bundles

---

# Demo

## porter push + docker app install

---
class: center, middle

# BREAK

---
class: center, middle

# Manage Bundles with Porter

.center[
  🚨 Not Setup Yet? 🚨

  https://porter.sh/pack-your-bags/#setup
  
  ]
---
name: hello
class: center

# Tutorial
# Hello World

.center[
  ![whale saying hello](/images/whale-hello.png)
]
---

## porter create

```console
$ porter create --help
Create a bundle. This generates a porter bundle in the current directory.
```

---

### porter.yaml
**The most important file**.  Edit and check this in. Everything else is optional.

### README.md
Explains the other files in detail

### Dockerfile.tmpl
Optional template for your bundle's invocation image

### .gitignore
Suggested set of files to ignore in git

### .dockerignore
Suggested set of files to not include in your bundle

---

# porter.yaml

```yaml
mixins:
  - exec

name: HELLO
version: 0.1.0
description: "An example Porter configuration"
invocationImage: porter-hello:latest

install:
  - exec:
      description: "Install Hello World"
      command: bash
      arguments:
        - -c
        - echo Hello World
```

---

## Try it out: porter create

```console
$ mkdir hello
$ porter create
creating porter configuration in the current directory
$ ls
Dockerfile.tmpl  README.md  porter.yaml
```

---

## porter build

```console
$ porter build --help
Builds the bundle in the current directory by generating a Dockerfile 
and a CNAB bundle.json, and then building the invocation image.
```

---

## Try it out: porter build

```console
$ porter build

Copying dependencies ===>
Copying porter runtime ===>
Copying mixins ===>
Copying mixin exec ===>
Generating Dockerfile =======>
Writing Dockerfile =======>
Starting Invocation Image Build =======>
Generating Bundle File with Invocation Image porter-hello:latest =======>
Generating parameter definition porter-debug ====>
```

---

# What did Porter do? 🔎

---
### Dockerfile
```Dockerfile
FROM quay.io/deis/lightweight-docker-go:v0.2.0
FROM debian:stretch
COPY --from=0 /etc/ssl/certs/ca-certificates.crt /etc/ssl/certs/ca-certificates.crt

COPY . /cnab/app
RUN mv /cnab/app/cnab/app/* /cnab/app && rm -r /cnab/app/cnab
# exec mixin has no buildtime dependencies
```
.footnote[🚨 Generated by Porter]

---

### cnab/
```console
$ tree cnab/
cnab
├── app
│   ├── mixins
│   │   └── exec
│   │       ├── exec
│   │       └── exec-runtime
│   ├── porter-runtime
│   └── run
└── bundle.json
```

### cnab/app/run

```bash
#!/usr/bin/env bash
exec /cnab/app/porter-runtime run -f /cnab/app/porter.yaml
```
.footnote[🚨 Generated by Porter]

---

### bundle.json
```json
{
    "description": "An example Porter configuration",
    "invocationImages": [
        {
            "image": "porter-hello:latest",
            "imageType": "docker"
        }
    ],
    "name": "HELLO",
    "parameters": {
        "porter-debug": {
            "destination": {
                "env": "PORTER_DEBUG"
            },
            "metadata": {
                "description": "Print debug information from Porter when executing the bundle"
            },
            "type": "bool"
        }
    },
    "version": "0.1.0"
}
```
.footnote[🚨 Generated by Porter]

---

## porter install

```console
$ porter install --help
Install a bundle.

The first argument is the name of the claim to create for the installation. 
The claim name defaults to the name of the bundle.

Flags:
  -c, --cred strings         Credential to use when installing the bundle. 
  -f, --file string          Path to the bundle file to install.
      --param strings        Define an individual parameter in the form NAME=VALUE.
      --param-file strings   Path to a parameters definition file for the bundle
```

---
## CNAB: What Executes Where

TODO PICTURE

---

## Try it out: porter install

```console
$ porter install

installing HELLO...
executing porter install configuration from /cnab/app/porter.yaml
Install Hello World
Hello World
execution completed successfully!
```

---
# Hello X Tutorial 

---

# Wordpress Tutorial

---
class: center, middle

# BREAK

---
class: center, middle

# Authoring Bundles

---

# Porter Manifest In-Depth

---

# Steps and Actions

---

# Wiring

---

# Templating

---
class: center, middle

# Mixins

---

# Step Outputs

---

# Make Your Own Mixin

---

# Break Glass

---
class: center, middle

# CNAB Best Practices

---

# What would you really put into a bundle?

---

# What does a real bundle look like?

???
Look at the azure examples and quick starts

---

# How does this fit into a CI/C pipeline?

---
class: center, middle

# Tooling

---

# CNAB Tooling Ecosystem

???
Explain where porter shines, what it is good at vs. say docker app

---

# Duffle

???
Mention duffle as a ops tool for managing bundles from multiple orgins at runtime

---
class: center, middle

# Beyond!

---

# Roadmap

???

Both CNAB and Porter for the next 3 months and rest of the year

---

# Next Steps

???
What should someone do if they are interested in CNAB for their work or personal projects?
What is the timeline for the project and how should they be thinking about beginning to incorporate it?

---

# Contribute!

---
class: center, middle

# Choose your own adventure

* Cloud + Break Glass
* Order a pizza with Porter
* Make a mixin